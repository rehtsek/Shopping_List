<!DOCTYPE html>
<html>
<head>
<!-- jquery library-->
<meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<style>
/*css style for font*/
li {font-sze:2em}
/*Create a class to notify when item has been clicked as bought or for deletion*/
.bought {color:#d3d3d3}
/* creat class called toBuy for unbought items*/
.toBuy {color:black}
</style>
</head>
<body>

<div class="container">
<form>
    <div class="form-group">
      <div class="col-xs-2">
      <label for="item">New item:</label>
      <input type="text" class="form-control" id="item">
    </div>
      <div class="col-xs-2">
      <label for="qty">Quantity:</label>
      <input type="text" class="form-control" id="quantity">
    </div>
      </div>
  </form>
</div>
<br/>

<div class="container">
<button type="button" onclick="newList('testing5');" class="btn bnt-default">Create new List</button>
<button type="button" onclick="addItem('testing5');" class="btn bnt-default">+</button>
<button type="button" onclick="getList();" class="btn bnt-default">Show Shopping List</button>
<button type="button" onclick="getListItems('testing1');" class="btn bnt-default">Show List Items</button>
<button type="button" onclick="deleteItem('testing2',2);" class="btn bnt-default">Delete Items</button>
<button type="button" onclick="showList();" class="btn bnt-default">Show whole list with items</button>
<button type="button" onclick="deleteList('testing');" class="btn bnt-default">Delete Shopping List</button>
<button type="button" onclick="updateStatus('testing5','id',2);" class="btn bnt-default">Update Shopping List</button>
</div>

<script>
var data = {};
var myShoppingLists = "ekShoppingList";
$("#sitem li").click(function () {
 $("#sitem li").wrap("<strike>");
});
//function for creating new shopping list
function creatNewList(){
	//localStorage.removeItem("ekShoppingList");
	var existingEntries = JSON.parse(localStorage.getItem(myShoppingLists));
if(existingEntries == null) existingEntries = {};
var listname = $("#newList").val();
	var dd = {};
	dd[newList] = [];

 $.extend(existingEntries, dd );

localStorage.setItem(myShoppingLists, JSON.stringify(existingEntries));
//console.log(JSON.stringify(existingEntries));
}

//adding item to a shopping list
//require: listName
function addItem(listName){
	var existingEntries = JSON.parse(localStorage.getItem(myShoppingLists));
	var entryItem = $("#item").val();
    var entryQty = $("#quantity").val();
   var len = existingEntries[listName].length-1;
   if(len == -1){i=1}else{
    var i = existingEntries[listName][len];
	i = i.id;
	i = i+1;}
	console.log(i);
  existingEntries[listName].push(
    {id: i, item: entryItem, quantity: entryQty, status: "new"}
);

localStorage.setItem(myShoppingLists, JSON.stringify(existingEntries));
console.log(JSON.stringify(existingEntries));
}
// lists shopping list names
function getList(){
	var existingEntries = JSON.parse(localStorage.getItem(myShoppingLists));
var keys = [];
   for(var k in existingEntries) keys.push(k);

   $.each(keys,function(i,obj) {
       $('<li style="color:black" onclick="getListItems(\'' + obj + '\')">',{text:obj}).appendTo("#shoplists");
   });
//console.log(JSON.stringify(keys));
}

// lists items in shopping list name
function getListItems(listName){
	var existingEntries = JSON.parse(localStorage.getItem(myShoppingLists));
var c = existingEntries[listName];
$( ".new-list" ).hide();
$( "#shoplists" ).hide();
$('<label for="male">'+listName+'</label>').appendTo("#itemLists");

c.forEach(function(obj) {
  $('<li>',{text:obj.item + ': '+obj.quantity }).appendTo("#itemLists");
  $('<input type="button" class="btn btn-primary" value="Del" onclick="deleteItem(\'' + listName + '\',\'id\',\'' + obj.id + '\');" />').appendTo("#itemLists");
  //console.log(obj.item);
});
$('<input type="text" placeholder="Item Name" id="item">').appendTo("#itemLists");
$('<input type="text" placeholder="Quantity" size="5" id="quantity">').appendTo("#itemLists");
$('<input type="button" class="btn btn-primary" value="Add" onclick="addItem(\'' + listName + '\');" />').appendTo("#itemLists");

//console.log(JSON.stringify(c));
}

//updates items in shopping list
function updateStatus(listName, property, value){
	 var existingEntries = JSON.parse(localStorage.getItem(myShoppingLists));
	 $.each(existingEntries[listName], function(index, result) {

            if (result[property] == value) {
            	console.log(index);
				existingEntries[listName][index].status = "bought";
                return false;
            }

        });

    localStorage.setItem(myShoppingLists, JSON.stringify(existingEntries));
}
//delete item in shopping list
   function deleteItem1(listName, index) {
   var existingEntries = JSON.parse(localStorage.getItem(myShoppingLists));
   existingEntries[listName].splice(index,1);

    localStorage.setItem(myShoppingLists, JSON.stringify(existingEntries));
	console.log(JSON.stringify(existingEntries));
}

//to-do work on item name
   function deleteItem(listName, property, value) {
   var existingEntries = JSON.parse(localStorage.getItem(myShoppingLists));
        $.each(existingEntries[listName], function(index, result) {

            if (result[property] == value) {
            	console.log(index);
                existingEntries[listName].splice(index,1);
                return false;
            }

        });

    localStorage.setItem(myShoppingLists, JSON.stringify(existingEntries));
}
//deletes shopping list name completely
function deleteList(listName){
var existingEntries = JSON.parse(localStorage.getItem(myShoppingLists));
delete existingEntries[listName];
localStorage.setItem(myShoppingLists, JSON.stringify(existingEntries));
}

// show shopping lists created
function showList(){

	var existingEntries = JSON.parse(localStorage.getItem(myShoppingLists));
	console.log(JSON.stringify(existingEntries));
}

</script>
</body>
</html>
